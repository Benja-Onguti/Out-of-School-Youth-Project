// Contact Form Functionality
document.addEventListener("DOMContentLoaded", function () {
  const contactForm = document.getElementById("contactForm");
  if (!contactForm) return;

  // Create message container
  const messageContainer = document.createElement("div");
  messageContainer.className = "form__message";
  contactForm.insertBefore(messageContainer, contactForm.firstChild);

  // Form validation function
  function validateForm() {
    let isValid = true;
    const requiredFields = contactForm.querySelectorAll("[required]");

    // Clear previous errors
    contactForm.querySelectorAll(".form__group").forEach((group) => {
      group.classList.remove("error");
    });

    // Validate each required field
    requiredFields.forEach((field) => {
      const group = field.closest(".form__group");

      if (!field.value.trim()) {
        isValid = false;
        group.classList.add("error");
        showMessage("Please fill in all required fields.", "error");
      } else if (field.type === "email" && !isValidEmail(field.value)) {
        isValid = false;
        group.classList.add("error");
        showMessage("Please enter a valid email address.", "error");
      }
    });

    return isValid;
  }

  // Email validation helper
  function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  // Show message function
  function showMessage(text, type) {
    const messageContainer = contactForm.querySelector(".form__message");
    messageContainer.textContent = text;
    messageContainer.className = `form__message ${type}`;
    messageContainer.style.display = "block";

    // Auto-hide after 5 seconds
    setTimeout(() => {
      messageContainer.style.display = "none";
    }, 5000);
  }

  // Form submission handler
  contactForm.addEventListener("submit", async function (e) {
    e.preventDefault();

    // Validate form
    if (!validateForm()) {
      return;
    }

    // Show loading state
    const submitButton = contactForm.querySelector('button[type="submit"]');
    const originalText = submitButton.innerHTML;
    submitButton.innerHTML =
      '<i class="fas fa-spinner fa-spin"></i> Sending...';
    submitButton.disabled = true;

    try {
      // Submit to Web3Forms
      const formData = new FormData(contactForm);

      // You can also use fetch API for submission
      const response = await fetch("https://api.web3forms.com/submit", {
        method: "POST",
        body: formData,
      });

      const data = await response.json();

      if (data.success) {
        showMessage(
          "Message sent successfully! We'll get back to you soon.",
          "success",
        );
        contactForm.reset();
      } else {
        showMessage("Failed to send message. Please try again.", "error");
      }
    } catch (error) {
      showMessage(
        "Network error. Please check your connection and try again.",
        "error",
      );
      console.error("Form submission error:", error);
    } finally {
      // Restore button state
      submitButton.innerHTML = originalText;
      submitButton.disabled = false;
    }
  });

  // Real-time validation on blur
  contactForm.querySelectorAll("input, textarea, select").forEach((field) => {
    field.addEventListener("blur", function () {
      const group = this.closest(".form__group");

      if (this.hasAttribute("required") && !this.value.trim()) {
        group.classList.add("error");
      } else if (
        this.type === "email" &&
        this.value &&
        !isValidEmail(this.value)
      ) {
        group.classList.add("error");
      } else {
        group.classList.remove("error");
      }
    });

    // Remove error on input
    field.addEventListener("input", function () {
      const group = this.closest(".form__group");
      group.classList.remove("error");
    });
  });
});

document.addEventListener("DOMContentLoaded", function () {
  // Get carousel elements
  const carousel = document.querySelector(".testimonials__carousel");
  if (!carousel) return;

  const track = carousel.querySelector(".testimonials__track");
  const cards = carousel.querySelectorAll(".testimonial-card");
  const prevBtn = carousel.querySelector(".carousel__btn--prev");
  const nextBtn = carousel.querySelector(".carousel__btn--next");
  const indicators = carousel.querySelectorAll(".carousel__indicator");

  let currentIndex = 0;
  const totalCards = cards.length;
  const gap = 30; // Same as CSS gap

  // Function to calculate slide width
  function getSlideWidth() {
    const card = cards[0];
    if (!card) return 0;
    const cardStyle = getComputedStyle(card);
    const cardWidth = card.offsetWidth;
    const marginLeft = parseInt(cardStyle.marginLeft) || 0;
    const marginRight = parseInt(cardStyle.marginRight) || 0;
    return cardWidth + marginLeft + marginRight;
  }

  // Function to update carousel position
  function updateCarousel() {
    const slideWidth = getSlideWidth();
    const moveX = -(currentIndex * (slideWidth + gap));
    track.style.transform = `translateX(${moveX}px)`;

    // Update active states
    cards.forEach((card, index) => {
      card.classList.toggle("active", index === currentIndex);
    });

    // Update button states
    prevBtn.disabled = currentIndex === 0;
    nextBtn.disabled = currentIndex === totalCards - 1;

    // Update indicators
    indicators.forEach((indicator, index) => {
      indicator.classList.toggle("active", index === currentIndex);
    });
  }

  // Navigation functions
  function goToSlide(index) {
    if (index >= 0 && index < totalCards) {
      currentIndex = index;
      updateCarousel();
    }
  }

  function nextSlide() {
    if (currentIndex < totalCards - 1) {
      currentIndex++;
    } else {
      currentIndex = 0; // Loop to start
    }
    updateCarousel();
  }

  function prevSlide() {
    if (currentIndex > 0) {
      currentIndex--;
    } else {
      currentIndex = totalCards - 1; // Loop to end
    }
    updateCarousel();
  }

  // Event listeners
  prevBtn.addEventListener("click", prevSlide);
  nextBtn.addEventListener("click", nextSlide);

  indicators.forEach((indicator, index) => {
    indicator.addEventListener("click", () => goToSlide(index));
  });

  // Auto-rotate
  let autoRotate = setInterval(nextSlide, 5000);

  // Pause auto-rotate on hover
  carousel.addEventListener("mouseenter", () => {
    clearInterval(autoRotate);
  });

  carousel.addEventListener("mouseleave", () => {
    autoRotate = setInterval(nextSlide, 5000);
  });

  // Handle window resize
  let resizeTimeout;
  window.addEventListener("resize", () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
      updateCarousel();
    }, 250);
  });

  // Initialize
  updateCarousel();

  // Add keyboard navigation
  document.addEventListener("keydown", (e) => {
    if (e.key === "ArrowLeft") prevSlide();
    if (e.key === "ArrowRight") nextSlide();
  });
});
