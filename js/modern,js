// Contact Form Functionality
document.addEventListener("DOMContentLoaded", function () {
  const contactForm = document.getElementById("contactForm");
  if (!contactForm) return;

  // Create message container
  const messageContainer = document.createElement("div");
  messageContainer.className = "form__message";
  contactForm.insertBefore(messageContainer, contactForm.firstChild);

  // Form validation function
  function validateForm() {
    let isValid = true;
    const requiredFields = contactForm.querySelectorAll("[required]");

    // Clear previous errors
    contactForm.querySelectorAll(".form__group").forEach((group) => {
      group.classList.remove("error");
    });

    // Validate each required field
    requiredFields.forEach((field) => {
      const group = field.closest(".form__group");

      if (!field.value.trim()) {
        isValid = false;
        group.classList.add("error");
        showMessage("Please fill in all required fields.", "error");
      } else if (field.type === "email" && !isValidEmail(field.value)) {
        isValid = false;
        group.classList.add("error");
        showMessage("Please enter a valid email address.", "error");
      }
    });

    return isValid;
  }

  // Email validation helper
  function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  // Show message function
  function showMessage(text, type) {
    const messageContainer = contactForm.querySelector(".form__message");
    messageContainer.textContent = text;
    messageContainer.className = `form__message ${type}`;
    messageContainer.style.display = "block";

    // Auto-hide after 5 seconds
    setTimeout(() => {
      messageContainer.style.display = "none";
    }, 5000);
  }

  // Form submission handler
  contactForm.addEventListener("submit", async function (e) {
    e.preventDefault();

    // Validate form
    if (!validateForm()) {
      return;
    }

    // Show loading state
    const submitButton = contactForm.querySelector('button[type="submit"]');
    const originalText = submitButton.innerHTML;
    submitButton.innerHTML =
      '<i class="fas fa-spinner fa-spin"></i> Sending...';
    submitButton.disabled = true;

    try {
      // Submit to Web3Forms
      const formData = new FormData(contactForm);

      // You can also use fetch API for submission
      const response = await fetch("https://api.web3forms.com/submit", {
        method: "POST",
        body: formData,
      });

      const data = await response.json();

      if (data.success) {
        showMessage(
          "Message sent successfully! We'll get back to you soon.",
          "success",
        );
        contactForm.reset();
      } else {
        showMessage("Failed to send message. Please try again.", "error");
      }
    } catch (error) {
      showMessage(
        "Network error. Please check your connection and try again.",
        "error",
      );
      console.error("Form submission error:", error);
    } finally {
      // Restore button state
      submitButton.innerHTML = originalText;
      submitButton.disabled = false;
    }
  });

  // Real-time validation on blur
  contactForm.querySelectorAll("input, textarea, select").forEach((field) => {
    field.addEventListener("blur", function () {
      const group = this.closest(".form__group");

      if (this.hasAttribute("required") && !this.value.trim()) {
        group.classList.add("error");
      } else if (
        this.type === "email" &&
        this.value &&
        !isValidEmail(this.value)
      ) {
        group.classList.add("error");
      } else {
        group.classList.remove("error");
      }
    });

    // Remove error on input
    field.addEventListener("input", function () {
      const group = this.closest(".form__group");
      group.classList.remove("error");
    });
  });
});
